language: node_js
node_js:
  - "10"
sudo: false
cache:
  yarn: true
  directories:
    - "node_modules"
services:
  - mongodb
install:
  - yarn global add codecov
  - cd server
  - yarn
  - cd ../client
  - yarn
before_script:
  - pip install awscli --upgrade --user
  - export PATH=$PATH:$HOME/.local/bin
script:
  - yarn build
  - cd ../server
  - yarn lint
  - yarn test:coverage
after_success:
  - bash <(curl -s https://codecov.io/bash)
  # Delete bucket content
  - aws_access_key_id=${AWS_ACCESS_KEY_ID} aws_secret_access_key=${AWS_SECRET_ACCESS_KEY} aws s3 rm s3://euronotify.diogocardoso.me --recursive --region eu-west-2
before_deploy:
  - cd ../client
notifications:
  email: false
deploy:
  provider: s3
  access_key_id:
    secure: "nJjT13i1HqFWLzePAXmkuD61oNrDMWFkLWOvEb1UbUiEGZ1hYaPAl+2UMzEHGcJ/imgiByHWzPEKazBjEusW+X2oLnlTF8P3AVvrRwdkyIJqFSjwZzIcrT6oSUs2c7TRGyv6dB4QdJVAUeOToaVJ/1FIQhX0oi9l4m8JldwHF3m7kqzytPpnpy2JpESrj7tDhrhwzZlw3wkpd/dDzx+BXWrmuo7LnPR8y+rg/Up5h5R1PA/cGXpNUKMvOzY1wwt8Q36tF51gD8r1Pe7pn86y/WsR21i0yuusBHyA2Gyzto4XVZYjANbCY/km5tafxgxhBZ6PzYeb96EM1N74ojBZGWUIeuyybPA6i8hF7CSQQbd4+Z9WewXYSseE//7pp1W3snFgS4uE9tU7SeDnxDuOD3vQUdhLrpT5ySoT7IcQSPHGu4AzicOaoXTdzkmTEFRlINqLicnK3FqGEj28e6JsOQAC8jHDALdh+QGDf9kL4DXGDBU2Ks70B+enpACh8asSRsJAQ94iMcJ1XqqzEMHrBHbSNa7q8TPxHQhMuLHuOxyHblF5YI5W/FpfG3S+8MGyEpsnn3/Ey1qxdZ3HPny5+tDVcpcJv42tHcV0soBw5ezLLS7a8UVoDbp9gh6YhD2IWrzmVXVqD+XF8KxLW40KgNll1w4djg//7p8mngmzzjQ="
  secret_access_key:
    secure: "kN3qpzg0G60z/sU4BD5ihM61/FpDzDErcJbazHFsk3+p6EnPDvwTQccRO54lYEn8DbsN4DG+x7s/Ip70fKc86z4qHdFmKv1SFHMgLw4OgdOK71SSLru2UpFy/YaaDhHSU1acMk/blV+3b9oJEJof+SMcO/gVDr5xMnxqahBhv9Z9FBXPUG61+WpGM7+dzavYc/DAEiMKsjZvIPtUFXYWyszPrvu1DN9MSGjVC42saueBUkhibReSfGpFxeRiFOCpVK+olcMLukYYLMEA7DqotxSz5oevkrvd6AGn49NXyJkd8Kvk3LVp9RmbqGJKB488G7VQoEghdN3KnHwMOj3sxCzB8lp1lGcvrHRW27sM00cCUlSdLMKHonTcfcSHyqzbC3Cu62iqW2CDgCsvjm6QdhGHG9/4ncDbjGRPpItEelCDcWlckS4NaF1k3o2PJBnTRQqVe9xkS9QmNJeNUEpTQPMMOCrJCUrsKZlOScOVR6qYdIIVHW0s7WTnag9Sf0b/QjBgf32i3JSq5NOqcnmqlOTvHy6/k89Mzltz9CIvkT6492IJ8X8uF3ZBmMAEuiGNek+QKSyP4fjj1hYjvyZTQhQhK5OPyc/zXuh14XI3UWxR4zQ88Z78zKCuS2zTG+84sn6NAW2HH99uuYIRGLpb6eXnrrsHUld2lAhq4oPlt2A="
  bucket: euronotify.diogocardoso.me
  # Prevent Travis from deleting the build artifacts
  skip_cleanup: true
  region: eu-west-2
  # Deploy a single folder and not the entire project
  local_dir: build
after_deploy:
  - aws_access_key_id=${AWS_ACCESS_KEY_ID} aws_secret_access_key=${AWS_SECRET_ACCESS_KEY} aws cloudfront create-invalidation --distribution-id ${CF_DISTRIBUTION_ID} --paths "/*"
env:
  global:
    # PORT
    - secure: "IcUdzQ0s0b5W9r4EIXkOuWDp0T1Tq0NHqTaC0+YAyoBxjR1oOfvug8JJ+0+94jbwXa4HqlNw8Ou+ydJgiVJCmiG86P7EDTe3bujpzkcppRsL1iJaCg4M7hLJov/8QV8C0c39olfy/m83DnerKG7qldikzC8q+X5UtRkfHE4c5oDFIeMH6lM1F0+sYm1p+fZFY+qJW2vhMjaATQp5nU1A8K70mZyzDl7RpuevUGsEnBpv4EwTUrjev0R0QpFQMQ3aniryIXybC7HzCdbf1NhiOYVxQFGN3SznVgnqpGbfKlWJiLIauL/PHUx1GCWElRJV3cEOLgiiR2FoA9B33QB02jRQ4wyxONtvUCUOXT938efUtBYkr2xgFJwQn97UOdKzkGBwlQukDfMY9nFBksHhwmkr9pSX87cL17WLuoYhV8qJCHfIF9ogNQGsys9YOHZA2HRkqJW9a9X8SEVDKMfxEPEnCUq5Nh5RvL8ziVNEMP55jxrfRdMCvKKTatcIFNuU/HYUrdVoUskWABkI2xzywL4lD0aTgnJVdW7YlslGYLcQfilCKQYmd6PiDF4D1RRa/FZK9ereZJHar3yo+6r5OrNABsZly1YMsaxR4GFsAQfsaDWJBVsfdZiq9ftCEGpoib/ohJSOB/hP22AZoiuWNBz6Txe3fNOfjpL3YBM6V/k="
    # NODE_ENV
    - secure: "mWMGoYyuGL+B1X1XUfEMxMEAlXw1LER/L4KtTsGeDvzdcbDlZTCpTfwmQrGgwQhwXRtupry0kXhc6vCAeHxeaIHAhJFrGVM5nnjrOWB4WOAzpIFvyDGbk01IOX8DOFiMvi4O2AN7DpH3YeCVJxXkjyZhVSbGhjnUUBRPulFCWBvIlwL9BwjAR3ylOPknD31FMW3HxUxryOhinuen7x9606prFR3XKm36Z2rpGV6vY9IYTrTaVqKZXIJ9GCFTMrWvYc2LBoOreE5BGgO/1feYPR+HQAGs14xEXe4dXYEWJoLhxXNXLR+Ii+YvMfBNSBodUgTOeBNKs/dylT+1JhbTQYyI0QRpws89tyosvfJ8Mhfk6vOexGU/TBtNNhnrzT6EIZov7YKew4Vddbet5ur7o0WkYFMO1XXyXEkT0ot7PceWrlI3zbwHrGWbKc17u7T3AVUEncN9zV2tPv/ZeTi2IUCMqX5weUVzC+ees+LXQPOl6DWjgL7nhMvukTSy3zr/H8yFgTxj/nWyTHAhlq8JqrF0iPbocn/uY4a8U6XU821jJ43pOTf6TKhOz67+cAo/JZbpn4C9FSamze+U7Idd7kfxGv+23/9a4J3lT0roA14zDSqGSQhTMK9Yaxy9PiMZ+p1nC4jZ29AgnRO0mdCn0U0lBh03uTwKBeewjgIT6kc="
    # MONGODB_URI
    - secure: "BmqMm6CN9ZIztFxQHy/Kg62FaFcMrAFMmID0PQi6LpR72vvbmiqIIRjndwLEdPVygua8kcx8eJP0aqCckM9nbNVypSllbvv4e4n+OoIl9AuISsfWs0o9fLv0NMM9AvEb4oS/Cb6QhDyeGbsx7h9cxxD/fMzh33Jcl8DHss4bt34I9TJSupQef0ufzdHdTyhNdAP+NxW5UOSZabxpisEmbyKNhDGpyw6wmAv5BNv59SXN+MJipqt1uk9DqrkKgTiIZrFfLVEgTdZKXS5/1BZJ2rPlxHwvXVr96hebpQR4uutpyczTNUbtSMLA4ncxCRBGAg/UCvVGiAjJ1qMVggagAsb/FFAqa6G/gBD63rw/fw55LmEAeuCIff7HcktKLvHBmbR6W51PLR0wfLA4yJzQShwJxTDisvGqY+LvYq9wxFgTvAmt7+HPTkGq68QCcBhjKZcW5kPz9BD1J+LJ20UNAF3ep3+S13qoyWcTMEmnLQzf8ZcVeBwBQwV9JC12hX+RnZa1pLBVGOFvFNKbLYwtbCTJwBZcqUAzPr2UZvq7kGFiEwZEaLrRQOKgmD1UHF1NLJbH724m1pxQ8UhJb17bBIKGfsvj/WxKZB/RxTfPwXOEmucTpvHSygrn3dZmlwf4HxYqjVNGKrLeOQ7NJnJaUywLQIbtUxkBYzNUd//C924="
    # MONGODB_URI_TEST
    - secure: "f36cguzyC64gYvH1rAe8fnVP4biHR3q01RrBbzany5i7qeaZpR2SRm8zX14vr4H9qDvrWg/N5DwOFy926ZOCCYoG0sfchFTWBb5FKCPhBQj9uODyxXNUZy2qDOR8cDLEieY4FloAiCavOjdO4GIwenqhhuf8exGQBseFB7YN4TxY8sU8SO+XOoz3/dHSKwnMIt2nyqCU+4hjIe+FU96kr32MHfkfdoATfREhBjfXnP6TPZHtELid2CMtBZSf4mmCha7qY6n9eMrike0HO7jdP5KUHjiovKnc/5w0uvtm0dLzfPsmviNZoeh5jC7d/Ze6fRIlVtDiB25prZIYAvt0mL88pffe/cNDm1GQKY2aGU3ZJobLX9VSkFavivkgDQXlTclC7l1An2Tdi+JmylF0lfraZHvCF7vIFm2VxaUrlgbTsUbaYo7uXxuaoYuX4p21pmxMvfzTaMssAgLo5MVKfWlLQ6Uwl9l7DINaQc5tXui+igUS3RPiODZDghmJvUmxYAuBWp/PR1Lnt2buV0ebyTuADzjS4Y8GRZEMDmRQ72UQOt74GQddkDrXZBtoFNGIgMyt4HuaCt0XGq1d9aB5IeFyisA6QSCPoEdnBPpXm8dopX34GDnpIOtRvyD8JA4eKqZ75xDufImXsCvw83vTD/6DHGOMQS4Z/WtNVwOk5zU="
    # EMAIL_SENDGRID_API_KEY
    - secure: "iHRyubjQW8cs6r7tPbve6PoyDLdWwGTVitzII9ahwNOXWarwZVMNl6lcV3OzqXwWJRc8VCNCK/nhPvbLAMpxnb63pAwHBM7SBNpTafY7TXq1eDXR7ZwRY+zoXhLpqas1n77IyhyZG65rcj0keKyc73+0sHPxjlAYU/USd1vK1F7lXc50gcOANXI11LTFn2v+tgg2YktDlH4t78/ASpKdDYVuo1ltIiNfQQ/xS8TJCjKgzDXQdo83sZ7Mnbq2FzUaNLO2D+0zKRtIucv/pPmRebBpcNdsQNW34VwM9jqunJqUU1FDzU9yxGtv0gqMCsGhzGCPwnmrP4r3NiwhZf5PoKeSa54/1TpdLsHtwR/N+zU64KosXGK4YtG4Dv0cJMOhE9HLCuWyPjoYPu+tibr8xPom+nl0D9sjWPBt9Bhec3VC7+5KMZSisurpusj3XoW/a2YMGIPAbilv+GcPd9X/Rf+Hb2A4y4r2RzHOH0ZhfH3jFrgLfM7ITmL3DLAawsqWEP7NXP3AUeV7W9QFpR6CAT+cejB2KzQufFIQMtb5YJHP13VYkX/amU+mIC9iYnw/T7IDV72ZBNjOg7PLrrBMPNu06L/tpc46CHU3x6ZQV9/+t3ynLWjO9iLeRcX16PKqTzPn9U/bfEgapyrXQlqJDc+P1vJB7smz7ABEECnL/aA="
    # EMAIL_SENDGRID_API_KEY
    - secure: "bbh3X7Tfa951zU4h7YJFHg0Xx7QCtlZ67ELWP0aO3gX1439h/RUp5wXkwjntPbOsmHpmdb3tEsnEPC7B3NZ58bkP9QD/z/4HlzUYXeyZb8Msx0/wIm518ZxhaIPeYG/zzyLDQ1joYVY2J/RrE6goygtF7TIR7+BRrUxSxn5nij3a33/q26h1u1+L1Oe7/Wwl/RYdu0CaFqYbQlV2Ce0CsBQ5WfB0BL7x3kX3pYnH3jniCQastgJ89DD/vfoEgqkEWYV8yxiRm2/AxBCADMZsPVYp71qniAC4VtzGgdej49dd6ldLzI9g5KWs1e+RYGZ1EvPDsFvQcYRNBNqsUSyJjuLaljQaR7s45+RyEeeP830l7DF+gqCc2kmrg/KomMd3JKpNbImJ1JvlLQodsUQ+3dchcbH1KHkaDs38DFMttiFqgUvoJF/id/5Gw6hs1cvuTUlb7JLLcQuyM1Chd+jakJzoz+LCVESCdzL5q7NoDRTDDIICxZt8lOiW25Hkp3ik/JNKcMmESVqVT/Dba9pQ6qDiPsjLEfNyPAbYhqONXu2bYVGWcmh2P+03GuRxhbgjddcJ5ngJIc99Ol7XHzdUKjKOkQ1MPPaTmLRGYXyA4zcfI8t/MjNBICLKJ2M8kOW/vdSE8tbBr+Sy/9wNKNNIGVNp0pKrX10J+jhvfTvfU3c="
    # CF_DISTRIBUTION_ID - Cloudfront Distribution ID
    - secure: "fsD+1VcWGyRbanteqBjNUg+DoSBl0tKcF4kfgYCHn6sewJuFHyEJo8xU2A3Uv0WHWfU4AHK6+ZW37wlhk3R+W4I46i03QNabg6NRPUmwmUdB2wz8csv9qy8fDJUKazNk3rqaN6Hlv3tLyrd6VOj/LjzlhccdS2OqxhBYPaB2+U2URwEMbM3TSdjvEH9m7cPAX5gqiw6Ub4UXHU+YBP2JRL+ysh4b1iHuziemCo9wF1FKvWmNAfr0fUU4dE/8Gsk6fAoCi3ehNFpqkA/Q+9SQnyCFoAZzi3gNbTyshMl4itPsk7EPRe+q5gO2WMXZAtS6HACZXZWLkJNSQVXGIaJYka7X0sDyshcuRs/6dvfRbEkcnI3gMH37v6Ih9ezl43Asa2klQ+KJI7CGvghYAjtm1zYiN5zwvpuzR8JT0RfO/1I0S87jbwalaE0LecMQ1UhJEdVLVFpOoRhVq6Trw4Se9gVtYC9ZqeByq15g4ZEslnp+b2jnbGG1MmLw1NOeaDTCv0NoHBAdFsxPAcQSrGzgfvWQH8WtQHFd08Bl2vkFN4c2G+bYtfzcUlZIcz2/LyqmnV0GuZckWaWuNF4ERsqZCfOI+TqBGY2MFbu/UuGXYbAUOXsHVB5/vjBm+2tWVeBf+VRte9uB94vyqZvb4jGtCxa5QMJ2cIPRddI93TLeVqc="
    # AWS_ACCESS_KEY_ID - AWS Access Key ID
    - secure: "kXQhN5NFUJMM56t2APK3i99QK/wH4CI6zEuDj1hDAVGqa+0eI+ub+4/V/iOtGKX2kYKcL8XHVI3X9O9DsPHxdInuB7R9XerZaChXvwSDRONYIF9z+VajRymVLrmdJq+a5rOahQ2EyVxfLxxICQFo5ZGZLQo9redi8Rf+gMaS2A6e2O9g6dK37W9aU1VA8N/ugSKwoYt6MtaUKWKfDdtsFrzehM2Jic4+zPDyXOVQvn4DrpultWSHDmJK3wwQIndyw104dZQVRnRlAwUEON0FGQo0Vu5nQt3pdO2MyOH2o3PLw+vmANmrx8b0TtlaS3qUo4IP1uF5o6IA06TX52c+6tpFsumxpQ0xtsdIlzYLQOiIYhb4WLgxp8+zO+q7oIda/KBdBo/mSj+Qms3FJE7aC/REGajssm/LlKZE5vkczKAMgf4EYbxqLkSdfZHYvDQpRLix3tndy/aF+0imhR7PaXcaGUP04GJcy45g5EgVi9U0RNEVQ3l2o0e1DJMl6fbosy7UHyU7uvcOcLalYeLItNab+vE5ROfrzO24AhSAJapSPYyPFq3QfOcMVSyHonPeR6y9jX40xwHJWZN2r5C/roDWMLxflPoSsQfAMZQwwhPK41B4469ups2ueoyMfNbEwkvTLf2fSMuCYbYH8KnbYYoczQBvygM2hyTQIs6Jp7U="
    # AWS_SECRET_ACCESS_KEY - AWS Secret Access Key
    - secure: "h1Q3mD22p1XWYjzmZcKnvWT+Hy2YcFgBy1U7WsnERU3FD0pW+CwBbD0gTx7PtIgtJLiG+JHj+kQcq1TJr+2rwI403+txsE1nYNTpPhlaj+8eKpYlrpjxgENXZHznEo5mnN5PpmXrzwuH4saaPFTwzwOgnTXtddS2gKP4jaOo+Bq+uzlWntol3DGhijeW8wDq8lQja+0rACXSa46vm6ceLenWfIKnOEb5ZrsBii2uQ8xAxtb62TmwxlnemnKlfT0ZEsyA1s2GEUFcRKLJoWKHbTCZ0unKDS6QesE9RHysUduEbfeT89fp43lpPG7DTzLBiaigUKNxESrm0UmRwqkBoQEUGhwH8uRcyMmmaRP1TxVxF9L/Tx+ONZf9cm9wc9HRpzOBX91eZb7mexaCGzPh0pxeTx8raaiq4Clp69hQAMa0UUmRcW1GlmjCvaKrPIMLq913IeOXudnzXCzTShaSNupCHaQiRqMMOek30DzxVBPptDENy+jWd1KZRzANb5ih+YKXYRzB70zcDUcX1DL+homQsVteqe4J95FnoPBU/I9O6km7dE2gZkpW96laqqeY1aGz/TSpqJ7wHL57k9zJvzbPl/oUSKeEt3FusiSqJuO+KLFvaQ39eU0zzo2TEB/j1Gx7nct2fRTOyl0CgoqMdneTC21qr105IqMeq1iS6ls="
